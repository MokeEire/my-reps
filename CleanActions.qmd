---
title: "Cleaning Legislative Actions Data"
date: "`r Sys.Date()`"
format: 
  html:
    theme: litera
editor: visual
---

```{r}
#| label: setup
#| include: false
library(extrafont)
library(tictoc)
library(furrr)
library(here)
library(reactable)
library(reactablefmtr)
plan(multisession)
source("R/parsing_functions.R")

knit_print.data.frame = function(x, ...){
  knitr::knit_print(
    reactable::reactable(x,
                     theme = moke_rt(),
                     compact = F, fullWidth = T,height = "400px",
                     resizable = T),
    ...
    )
}

action_codes = read_csv(here("data", "action_codes.csv"), col_types = "cc")

all_bills = readRDS(here("data", "cleaned", "BILLSTATUS_117.Rds"))
actions = readRDS(here("data", "cleaned", "BILLSTATUS_117_Actions.Rds"))
```

# Actions

Now, let's `unnest()` the actions data and see what action-level information looks like.

```{r}
#| column: page

(actions_unnested = select(all_bills, 
                           where(negate(is_list)), 
                           starts_with("action")) %>% 
   # Unnest actions
  unnest(actions)) %>% 
  head(20) %>% 
  select(bill_id, title, introducedDate, starts_with("action"))
```

In order to understand how legislation moves through congress, the chronological order of actions is important to know. `actionDate` and `actionTime` are the two fields which provide this information. Unfortunately, `actionTime` is missing in 90% of cases.

```{r}
# Calculate how many actions are missing date and time data
actions_unnested %>% 
  summarise(
    n_actions = n(),
    across(c(actionDate, actionTime), 
           list(n = ~sum(is.na(.), na.rm = T), 
                pct = ~scales::percent(sum(is.na(.), na.rm = T)/n_actions)))
  ) %>% 
  # Pivot summary for table
  pivot_longer(cols = starts_with("action"), 
               names_to = c("field", ".value"), names_sep = "_")
```

Because time information is missing and often actions of different types occur on the same day, we need to make use `action_type` to identify the order of actions.

::: callout-note
## Assumption

Congressional actions follow the following order:\
Intro/Referral -\> Committee -\> Floor -\> Discharge, President -\> Become Law

```{r}
actions_order = c("IntroReferral", "Committee", "Floor", 
                  "Discharge", "President", "BecameLaw")
```
:::

```{r}

(actions_coded = actions_unnested %>% 
    # Create action timestamp
    mutate(action_ts = make_datetime(year = year(actionDate), 
                                     month = month(actionDate), 
                                     day = day(actionDate), 
                                     hour = coalesce(hour(actionTime), 0), 
                                     min = coalesce(minute(actionTime), 0), 
                                     sec = coalesce(second(actionTime), 0), 
                                     tz = "US/Eastern"),
           # Set action type order
           action_type_fct = fct_explicit_na(
             factor(action_type, 
                    levels = actions_order, 
                    ordered = T),
             na_level = "(Missing Action Type)"
           ),
           action_source_name = factor(action_source_name,
                                       levels = c("Library of Congress", 
                                                  "House floor actions", 
                                                  "House committee actions",
                                                  "Senate"),
                                       ordered = T)) %>% 
    arrange(bill_id, action_ts) %>% 
    select(-actionDate, actionTime) %>% 
    relocate(action_ts, action_type, action_text, 
                    actionCode, action_type_fct,
                    action_source_name, action_source_code,
                    starts_with("action_committee"), .after = title)) %>% 
  select(title, bill_id, starts_with("action"))
```

## Action Types

What action types are most common?

```{r}
#| label: count-action-type
actions_coded %>%
  count(billType, action_type) %>% 
  arrange(billType, desc(n)) %>% 
  pivot_wider(names_from = action_type, values_from = n, values_fill = 0)
```

Or in a graph:

```{r}
#| label: action-type-prop
#| fig.width: 10
#| fig.height: 6
actions_coded %>%
  count(billType, action_type) %>% 
  arrange(billType, n) %>% 
  # Calculate % of bill's actions
  group_by(billType) %>% 
  mutate(pct = n/sum(n),
         pct_lab = if_else(pct > .08, scales::percent(pct, accuracy = .1), NA_character_)) %>% 
  ungroup() %>%
  # Plot
  ggplot(., aes(y = billType, fill = fct_rev(action_type)))+
  geom_col(aes(x = n), 
           colour = my_col_pal[1], width = .6, 
           position = position_fill())+
  geom_text(aes(x = n, label = pct_lab), 
           position = position_fill(vjust = .5),
           family = "Heebo Light", fontface = "bold",
           colour = my_col_pal[1],
           size = 5)+
  scale_x_continuous(name = NULL, 
                     labels = scales::percent, 
                     breaks = scales::breaks_pretty(),
                     expand = expansion(add = .01))+
  scale_fill_manual(name = "Action\nType", 
                    values = viz_colours[length(unique(actions_unnested$action_type)):1],
                    guide = guide_legend(title.position = "left", 
                                         title.hjust = .5,
                                         label.position = "top", 
                                         keywidth = unit(2.5, "cm"),
                                         #direction = "horizontal", 
                                         nrow = 1, reverse = T))+
  labs(title = "Most common congressional actions taken on bills",
       subtitle = "Actions as proportion of total bill activity, by bill type",
       y = NULL)+
  # facet_wrap(~billType, scales = "free_y")+
  theme_moke(plot_margin = margin(20,20,20,20))+
  # theme_minimal()+
  theme(legend.position = "top",
        axis.line.y = element_blank(),
        legend.title = element_text(margin = margin(l = 0, r = 20)),
        legend.box.just = "left",
        panel.grid.major.y = element_blank(), 
        panel.grid.major.x = element_line())
```

Can we get an idea of the order of actions based on their average position in the data?

```{r}
#| label:  action-order-summary
(action_order_summary = actions_coded %>% 
  group_by(billType, action_type) %>% 
  summarise(across(action_number, list(min = min, 
                                       y25 = ~quantile(., .25), 
                                       mean = mean, median = median, 
                                       y75 = ~quantile(., .75),
                                       max = max), na.rm=T)))
```

```{r}
#| label:  action-order-boxplot
action_order_summary %>%
  pivot_longer(
    cols = starts_with("action_n"), 
    names_to = "measure", values_to = "value",
    names_transform = list(
      measure = ~str_remove_all(., "^action_number_")
      )
    )

action_order_summary %>% 
  ggplot(., aes(x = action_type))+
  geom_boxplot(
    aes(ymin = action_number_min, 
        lower = action_number_y25, 
        middle = action_number_median, 
        upper = action_number_y75,
        ymax = action_number_max),
    stat = "identity"
  )+
  facet_wrap(~billType)+
  theme_moke(plots_pane = T)+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r }
#| label:  action-order-boxplot2
actions_unnested %>% 
  group_by(action_type) %>% 
  mutate(mean_num = mean(action_number)) %>% 
  ungroup() %>% 
  arrange(mean_num) %>% 
  mutate(action_type = fct_inorder(factor(action_type))) %>% 
  ggplot(., aes(x = action_type, y = action_number))+
  geom_boxplot()+
  labs(title = "In what order do actions typically occur?", x = NULL)+
  facet_wrap(~billType)+
  theme_moke(plots_pane = T)

```

```{r }
#| label:  sample-actions-plot
actions_unnested %>% 
  filter(bill_id == sample(bill_id, 1)) -> sample_bill_actions

sample_bill_actions %>% 
  # Plot
  ggplot(., aes(x = actionDate))+
  # Line connecting points
  geom_line(aes(y = ..count.., group = bill_id), stat = "count", size = .8, alpha = .8)+
  # Points using the count of each action type on a given date
  geom_point(aes(colour = action_type, size = ..count..), stat = "count")+
  labs(title = "Bill actions over time", 
       x = "Action Date", y = "# of actions")+
  scale_size(guide = "none", range = c(2,7))+
  theme_moke(plots_pane = T)
```

# Cleaning Action Codes

The actions data is messy. There are a number of cases where actions are duplicated in the data which need to reconcile in order to make sense of the legislative timeline. Are we able to identify duplicate actions using action codes?

```{r }
#| label:  action-codes
actions_unnested %>% 
  select(bill_id, actionDate, actionTime, action_type, actionCode, Action) %>% 
  count(actionCode, Action) %>% 
  arrange(actionCode, Action)
```

How many of the actions are actually coded?

```{r }
#| label:  action-code-hist
actions_unnested %>% 
  group_by(bill_id) %>%
  summarise(
    actions = n(),
    actions_w_code = sum(!is.na(Action)),
    actions_coded = actions_w_code/actions
  ) %>% 
  ggplot(., aes(x = actions_coded))+
  geom_histogram(fill = my_col_pal[5], colour = my_col_pal[1])+
  scale_x_continuous(labels = scales::percent)+
  scale_y_continuous(labels = scales::comma, expand = expansion())+
  labs(title = "Presence of action codes in House bills",
       subtitle = "Proportion of coded actions in house congressional data",
       y = "# of bills", x = "% of actions coded")+
  theme_moke(plots_pane = T)
```

Below are a list of the cases I have found:

-   Action code `E30000` and `36000` with action type `President` and `BecameLaw` respectively appear to both represent the president signing a bill into law, while action codes `E40000` and `36000` with the same respective action types represent a bill becoming a public law. In this case, action type `President` and `BecameLaw` are interchangeable
-   Action code `Intro-H` appears to be a duplicate of action code `1000`, both of which are `IntroReferral` action types

Which action types have action codes?

```{r}
#| label: action-codes-summary
actions_unnested %>% 
  group_by(action_type) %>% 
  summarise(
    n = n(),
    n_coded = sum(!is.na(actionCode)),
    pct_coded = n_coded/n
  )
```

## Intro/Referral

```{r }
#| label: intro-action-codes
actions_unnested %>% 
  filter(action_type == "IntroReferral") %>% 
  count(action_source_name, actionCode, sort = T)
```

```{r }
#| label: intro-actions
actions_unnested %>% 
  filter(action_type == "IntroReferral") %>% 
  count(actionCode, Action, action_text) %>% 
  arrange(actionCode, desc(n))# %>% 
  # View("Intro/Referral Action Codes")
```

Below is a table of the action codes and their meaning

+-------------+----------------------------------------------------------+----------------+
| Action Code | Action                                                   | Given/Inferred |
+=============+==========================================================+================+
| `1000`      | Introduced in House                                      | Given          |
+-------------+----------------------------------------------------------+----------------+
| `B00100`    | Sponsor introductory remarks on measure                  | Inferred       |
+-------------+----------------------------------------------------------+----------------+
| `H11100`    | Referred to Committee                                    | Inferred       |
+-------------+----------------------------------------------------------+----------------+
| `H11210`    | Committee granted an extension for further consideration | Inferred       |
+-------------+----------------------------------------------------------+----------------+
| `Intro-H`   | Introduced in House                                      | Inferred       |
+-------------+----------------------------------------------------------+----------------+

: Intro/Referral Action Codes

Is there a difference between the `actionCode` **1000** and **Intro-H**?

```{r }
#| label: compare-intro
actions_to_compare = c("1000", "Intro-H")

actions_unnested %>% 
  filter(actionCode %in% actions_to_compare) %>% 
  add_count(bill_id) %>% 
  filter(n>1) %>% 
  select(bill_id, billType, actionCode, action_source_name, action_ts, 
         Action, action_type, action_text) %>% 
  arrange(bill_id, actionCode)
```

Do these two actions occur for every bill?

```{r }
#| label: intro-code-comparison
actions_unnested %>% 
  filter(actionCode %in% actions_to_compare) %>% 
  count(bill_id, actionCode) %>% 
  pivot_wider(id_cols = bill_id, names_from = actionCode, values_from = n, values_fill = 0) %>% 
  count(`1000`, `Intro-H`, name = "bills")
```

No, `1000` occurs for every bill, but `Intro-H` does not.

So we can remove `Intro-H` actions without losing any information. This reduces the size of the actions data by \~8,000 rows.

```{r}
#| label: intro-code-dedupe
actions_unnested %>% 
  select(bill_id, title, introducedDate, 
         action_ts, action_type, actionCode, action_text,
         starts_with("action_source"), starts_with("action_committee")) %>% 
  # Remove Intro-H action codes (keep NAs)
  filter(replace_na(actionCode != "Intro-H", T)) %>% 
  arrange(bill_id, action_ts) %>% 
  head()
```

## Committee

```{r }
#| label: committee-action-codes
actions_unnested %>% 
  filter(action_type == "Committee") %>% 
  count(action_source_name, actionCode, sort = T)
```

```{r }
#| label: committee-actions
actions_unnested %>% 
  filter(action_type == "Committee") %>% 
  count(actionCode, Action, action_text) %>% 
  arrange(actionCode, desc(n)) %>% 
  head()# %>% 
  # View("Committee Action Codes")

```

+---------------+-------------------------------------------+----------------+
| Action Code   | Action                                    | Given/Inferred |
+===============+===========================================+================+
| `14000`       | Reported to Senate                        | Given          |
+---------------+-------------------------------------------+----------------+
| `14500`       | Senate committee discharged               | Given          |
+---------------+-------------------------------------------+----------------+
| `5000`        | Reported to House                         | Given          |
+---------------+-------------------------------------------+----------------+
| `5500`        | House committee discharged                | Given          |
+---------------+-------------------------------------------+----------------+
| `H12100`      | House committee reported original measure | Inferred       |
+---------------+-------------------------------------------+----------------+
| `H12200`      | Reported or amended by committee          | Inferred       |
+---------------+-------------------------------------------+----------------+
| `H12210`      | Supplemental report filed                 | Inferred       |
+---------------+-------------------------------------------+----------------+

: Committee Action Codes

Committee actions which do not have an action code include the following types of actions:

-   Referred to Subcommittee

-   Committee /Subcommittee Hearings Held

-   Ordered to be Reported

    -   in the Nature of a Substitute

    -   by Voice Vote/Unanimous Consent/the Yeas and Nays

-   Subcommittee Consideration and Mark-up Session Held

-   Subcommittee discharged

-   Forwarded by Subcommittee to Full Committee by Voice Vote

-   Executive Comment Requested/Received

## Floor

```{r }
#| label: floor-action-codes
actions_unnested %>% 
  filter(action_type == "Floor") %>% 
  count(action_source_name, actionCode, sort = T)
```

```{r }
#| label: floor-actions
actions_unnested %>% 
  filter(action_type == "Floor") %>% 
  add_count(actionCode, name = "actionCode_count") %>% 
  # Select distinct action codes and their descriptions
  distinct(actionCode, actionCode_count,
           Action, action_text_trunc = str_trunc(action_text, width = 60),
           action_text) %>%
  # sort by frequency
  arrange(desc(actionCode_count), actionCode) %>% 
  head()# %>% 
  # View("Floor Action Codes")
```

+-------------+----------------------------------------------------------------------------------------------+----------------+
| Action Code | Action                                                                                       | Given/Inferred |
+=============+==============================================================================================+================+
| `17000`     | Passed/agreed to in Senate                                                                   | Given          |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `8000`      | Passed/agreed to in House                                                                    | Given          |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `9000`      | Failed of passage/not agreed to in House                                                     | Given          |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `E20000`    | Presented to President                                                                       | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H12700`    | Provision of consideration and/or debate                                                     | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H1B000`    | Pursuant to provisions of H. Res. 41/85/330/380/403/473/486/504/ 535/601/912, resolution is: | Inferred       |
|             |                                                                                              |                |
|             | -   considered passed House                                                                  |                |
|             |                                                                                              |                |
|             | -   considered vacated                                                                       |                |
|             |                                                                                              |                |
|             | -   laid on the table                                                                        |                |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H1L210`    | Rules committee resolution reported to house                                                 | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H1L220`    | Rule passed House                                                                            | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H30000`    | Considered:                                                                                  | Inferred       |
|             |                                                                                              |                |
|             | -   as privileged matter                                                                     |                |
|             |                                                                                              |                |
|             | -   as unfinished business                                                                   |                |
|             |                                                                                              |                |
|             | -   by unanimous consent                                                                     |                |
|             |                                                                                              |                |
|             | -   under suspension of the rules                                                            |                |
|             |                                                                                              |                |
|             | -   under provisions of rule H. Res. XXX                                                     |                |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H30200`    | -   Request for unanimous consent to consider bill                                           | Inferred       |
|             |                                                                                              |                |
|             | -   Chair lays bill before the House w/o objection                                           |                |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H30300`    | Move to suspend rules and pass the bill/agree to the resolution                              | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H30800`    | Consideration initiated                                                                      | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H35000`    | Previous question ordered:                                                                   | Inferred       |
|             |                                                                                              |                |
|             | -   pursuant to the rule                                                                     |                |
|             |                                                                                              |                |
|             | -   pursuant to a previous order of the House                                                |                |
|             |                                                                                              |                |
|             | -   agreed to by vote                                                                        |                |
|             |                                                                                              |                |
|             | -   without objection                                                                        |                |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H36100`    | Move to commit w/instructions to a Select committee                                          | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H36110`    | Failed move to commit w/instructions                                                         | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H36200`    | Move to recommit to committee                                                                | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H36210`    | Failed move to recommit to committee                                                         | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H36500`    | Move to table the measure                                                                    | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H36510`    | Passed move to table the measure                                                             | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H36600`    | Move to:                                                                                     | Inferred       |
|             |                                                                                              |                |
|             | -   reconsider                                                                               |                |
|             |                                                                                              |                |
|             | -   table motion to reconsider                                                               |                |
|             |                                                                                              |                |
|             | -   agree                                                                                    |                |
|             |                                                                                              |                |
|             | -   postpone consideration                                                                   |                |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H36610`    | Passed move to:                                                                              | Inferred       |
|             |                                                                                              |                |
|             | -   reconsider                                                                               |                |
|             |                                                                                              |                |
|             | -   table motion to reconsider                                                               |                |
|             |                                                                                              |                |
|             | -   agree                                                                                    |                |
|             |                                                                                              |                |
|             | -   postpone consideration                                                                   |                |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H36700`    | Move to refer to a select committee                                                          | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H37100`    | Passage of/agreeing to resolution                                                            | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H37220`    | Vote demanded at conclusion of debate                                                        | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H37300`    | Vote on motion to suspend the rules and pass the bill /                                      | Inferred       |
|             |                                                                                              |                |
|             | Passage of bill under suspension of rules                                                    |                |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H38310`    | Motion to reconsider laid on the table                                                       | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H38400`    | Move to reconsider vote                                                                      | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H38410`    | Vote on motion to reconsider                                                                 | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H38800`    | Measure title amended                                                                        | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H38900`    | Clerk authorized to make technical and formatting corrections                                | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H8A000`    | Previous question on the motion was ordered                                                  | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+
| `H8D000`    | Debate                                                                                       | Inferred       |
+-------------+----------------------------------------------------------------------------------------------+----------------+

: Floor Action Codes

```{r }
#| label: floor-missing-codes
actions_unnested %>% 
  filter(action_type == "Floor", is.na(actionCode)) %>% 
  count(action_text, sort = T)# %>% 
  # View("Floor Actions missing codes")
```

Floor actions which do not have an action code appear to be Senate actions, but include the following types of actions:

-   Message on Senate action sent to the house

-   Passed Senate w/o amendment by Unanimous Consent/Voice Vote

-   Passed Senate with amendment

-   Cloture motion

    -   on the measure

    -   on the motion to proceed to the measure

    -   invoked/not invoked

-   Motion to proceed to consideration of measure in Senate

-   Motion to proceed to consideration of measure *agreed to* in Senate

-   Received, considered, and agreed to in the senate

-   Considered by Senate

-   Measure laid before Senate (by motion/unanimous consent)

-   Motion to commit to Senate Committee

-   Motion to appeal the ruling of the chair

-   Motion to reconsider cloture vote

## Discharge

```{r}
#| label: discharge-action-codes
actions_unnested %>% 
  filter(action_type == "Discharge") %>% 
  count(action_source_name, actionCode, sort = T)
```

```{r }
#| label: discharge-actions
actions_unnested %>% 
  filter(action_type == "Discharge") %>% 
  add_count(actionCode, name = "actionCode_count") %>% 
  # Select distinct action codes and their descriptions
  distinct(actionCode, actionCode_count,
           Action, action_text_trunc = str_trunc(action_text, width = 60),
           action_text) %>%
  # sort by frequency
  arrange(desc(actionCode_count), actionCode) %>% 
  head()# %>% 
  # View("Discharge Action Codes")

```

+---------------+--------------------------------+----------------+
| Action Code   | Action                         | Given/Inferred |
+===============+================================+================+
| `H12300`      | Committee discharged           | Inferred       |
+---------------+--------------------------------+----------------+
| `H17000`      | Motion to discharge committee  | Inferred       |
+---------------+--------------------------------+----------------+
| `H12490`      | Discharged from House Calendar | Inferred       |
+---------------+--------------------------------+----------------+

: Discharge Action Codes

## President

```{r }
#| label: president-action-codes
actions_unnested %>% 
  filter(action_type == "President") %>% 
  count(action_source_name, actionCode, sort = T)
```

```{r }
#| label: president-actions
actions_unnested %>% 
  filter(action_type == "President") %>% 
  add_count(actionCode, name = "actionCode_count") %>% 
  # Select distinct action codes and their descriptions
  distinct(actionCode, actionCode_count,
           Action, action_text_trunc = str_trunc(action_text, width = 60),
           action_text) %>%
  # sort by frequency
  arrange(desc(actionCode_count), actionCode) %>% 
  head()# %>% 
  # View("President Action Codes")
```

+---------------+-----------------------------+----------------+
| Action Code   | Action                      | Given/Inferred |
+===============+=============================+================+
| `28000`       | Presented to President      | Given          |
+---------------+-----------------------------+----------------+
| `E30000`      | Signed by President         | Inferred       |
+---------------+-----------------------------+----------------+
| `E40000`      | Became Public Law           | Inferred       |
+---------------+-----------------------------+----------------+

: President Action Codes

## Became Law

```{r }
#| label:  becamelaw-action-codes
actions_unnested %>% 
  filter(action_type == "BecameLaw") %>% 
  count(action_source_name, actionCode, sort = T)

```

```{r}
#| label: becamelaw-actions
actions_unnested %>% 
  filter(action_type == "BecameLaw") %>% 
  add_count(actionCode, name = "actionCode_count") %>% 
  # Select distinct action codes and their descriptions
  distinct(actionCode, actionCode_count,
           Action, action_text_trunc = str_trunc(action_text, width = 60),
           action_text) %>%
  # sort by frequency
  arrange(desc(actionCode_count), actionCode) %>% 
  head()# %>% 
  # View("Became Law Action Codes")
```

+---------------+-----------------------------+----------------+
| Action Code   | Action                      | Given/Inferred |
+===============+=============================+================+
| `36000`       | Became Public Law           | Given          |
+---------------+-----------------------------+----------------+

: Became Law Action Codes

## Missing Action Type

```{r }
#| label:  missing-actions
actions_unnested %>% 
  filter(action_type == "(Missing Action Type)") %>% 
  count(action_source_name, actionCode) %>% 
  arrange(actionCode, desc(n))

```

```{r}
#| label:  missing-action-codes
actions_unnested %>% 
  filter(action_type == "(Missing Action Type)") %>% 
  add_count(actionCode, name = "actionCode_count") %>% 
  # Select distinct action codes and their descriptions
  distinct(action_source_name, actionCode, actionCode_count,
           Action, action_text_trunc = str_trunc(action_text, width = 60),
           action_text) %>%
  # sort by frequency
  arrange(desc(actionCode_count), actionCode) %>% 
  head()# %>% 
  # View("Missing Type Action Codes")
```

+-------------+-----------------------------------------------------------------------------------+----------------+
| Action Code | Action                                                                            | Given/Inferred |
+=============+===================================================================================+================+
| `H12410`    | Placed on the Union Calendar                                                      | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H12420`    | Placed on the House Calendar                                                      | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H41931`    | Result of motion to reconsider                                                    | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `19500`     | Resolving differences                                                             | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H41610`    | Result of motion that the House agree to Senate amendment                         | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H82000`    | Move to table motion to reconsider/postpone consideration/refer                   | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H12440`    | Motion to place bill on consensus calendar                                        | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H41400`    | Previous question ordered pursuant to rule/previous House order                   | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H12430`    | Placed on the Private Calendar                                                    | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H40110`    | Request unanimous consent that the House to agree to Senate amendment(s)          | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H40140`    | Move to suspend rules and agree to Senate amendment(s)                            | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H40150`    | Move that the House agree to Senate amendment(s)                                  | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `80000`     | Amendment failed by the House                                                     | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H30230`    | An objection was heard to the unanimous consent request to consider the measure.  | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H40130`    | House moved to agree to the Senate amendment, pursuant to previous special order. | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+
| `H41930`    | Move to reconsider the vote                                                       | Inferred       |
+-------------+-----------------------------------------------------------------------------------+----------------+

: Missing Action Type Action Codes
